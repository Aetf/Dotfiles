# Helper function
uniqappend () {
    varname=$1
    x=$2
    case ":${!varname:=}:" in
        *":$x:"*) :;; # already there
        *) eval $varname=\"\$$varname:\$x\";;
    esac
    eval $varname=\"\$\{$varname\#:\}\"
}
uniqprepend () {
    varname=$1
    x=$2
    case ":${!varname:=}:" in
        *":$x:"*) :;; # already there
        *) eval $varname=\"\$x:\$$varname\";;
    esac
    eval $varname=\"\$\{$varname\%:\}\"
}

# Remove duplicate and nonexist entries
if [ -n "$PATH" ]; then
    old_PATH=$PATH:; PATH=
    while [ -n "$old_PATH" ]; do
        x=${old_PATH%%:*}       # the first remaining entry
        if [ -d "$x" ]; then
            uniqappend PATH $x
        fi
        old_PATH=${old_PATH#*:}
    done
    unset old_PATH x
fi
if [ -n "${LD_LIBRARY_PATH:=}" ]; then
    old_PATH=$LD_LIBRARY_PATH:; LD_LIBRARY_PATH=
    while [ -n "$old_PATH" ]; do
        x=${old_PATH%%:*}       # the first remaining entry
        if [ -d "$x" ]; then
            uniqappend LD_LIBRARY_PATH $x
        fi
        old_PATH=${old_PATH#*:}
    done
    unset old_PATH x
fi

# Basic locations
export DOWNLOAD_DIR=$HOME/downloads
export BUILD_DIR=$HOME/buildbed
export TOOL_DIR=$HOME/tools

# Extra Path
if [ -d $HOME/.local/bin ]; then
    uniqprepend PATH $HOME/.local/bin
fi

# Detect extra installations in tools
for pkg in $TOOL_DIR/*; do
    case $pkg in
        *.skip)
            continue;;
    esac
    inc_dir=$pkg/include
    bin_dir=$pkg/bin
    lib_dir=$pkg/lib
    if ! [ -d $lib_dir ]; then
        lib_dir=$pkg/lib64
    fi
    if [ -d $inc_dir ]; then
        uniqprepend INCLUDE $inc_dir
    fi
    if [ -d $bin_dir ]; then
        uniqprepend PATH $bin_dir
    fi
    if [ -d $lib_dir ]; then
        uniqprepend LD_LIBRARY_PATH $lib_dir
        uniqprepend LIB $lib_dir
    fi
done
export PATH
export LD_LIBRARY_PATH
export INCLUDE
export LIB

# Package specific variables
export JAVA_HOME=/usr/lib/jvm/java-8-oracle/

# Alias
alias ls='ls --color=auto -h -v --indicator-style=classify'
alias ll='ls -l'
alias la='ls -a'
alias lla='ls -al'

# Editor
export EDITOR=vim
