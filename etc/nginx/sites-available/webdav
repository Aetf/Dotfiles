server {
	listen 80;
	listen [::]:80;
	server_name dav.unlimited-code.works dav.unlimitedcodeworks.xyz;

	return 301 https://$server_name$request_uri;
}

server {
	listen 443 ssl http2;
	listen [::]:443 ssl http2;

	server_name dav.unlimited-code.works dav.unlimitedcodeworks.xyz;

	access_log /var/log/nginx/sites/webdav.access netdata;
	error_log /var/log/nginx/sites/webdav.error error;
	rewrite_log on;

    include snippets/cert/unlimited-code.works.conf;

    location /remote.php/dav/ {
        # increase body size
		client_body_temp_path /srv/http/tmp-body;
		client_max_body_size 0;

        # include details about the original request
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Original-Scheme $scheme;
        proxy_set_header X-Forwarded-Proto $scheme;

		# forward to nextcloud server
        proxy_set_header Host next.unlimited-code.works;
        proxy_pass https://localhost:443;
    }

    location / {
        deny all;
    }
}
